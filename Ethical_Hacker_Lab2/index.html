<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VulnShop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">

    <!-- Main Container -->
    <div class="bg-white shadow-xl rounded-2xl p-8 max-w-4xl w-full">

        <!-- Navigation Bar -->
        <nav class="flex justify-between items-center mb-10 pb-4 border-b border-gray-200">
            <a href="/" class="text-3xl font-bold text-gray-800 tracking-tight">VulnShop</a>
            <div class="flex space-x-4">
                <a href="/search?q=shirt" class="text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors duration-200">Search</a>
                <a href="/login" class="text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors duration-200">Login</a>
                <a href="/admin" class="text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors duration-200">Admin</a>
            </div>
        </nav>

        <!-- Main Content Section (Dynamically replaced by JS) -->
        <main id="main-content" class="text-center">
            <h1 class="text-5xl font-bold text-gray-900 mb-4">Welcome to VulnShop</h1>
            <p class="text-lg text-gray-600 mb-8">A sleek, modern e-commerce platform.</p>
            <p class="text-md text-gray-500">
                To get started, try the following:
                <br><code class="bg-gray-100 px-2 py-1 rounded-md text-sm font-mono text-gray-800">/search?q=shirt</code> to search for products
                <br><code class="bg-gray-100 px-2 py-1 rounded-md text-sm font-mono text-gray-800">/login</code> to access your account
            </p>
        </main>

    </div>

    <!-- JavaScript to handle dynamic content loading -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainContent = document.getElementById('main-content');

            // Function to fetch and display content from an endpoint
            async function fetchAndDisplayContent(url) {
                try {
                    const response = await fetch(url);
                    const text = await response.text();
                    // Extract the body content from the server response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const bodyContent = doc.body.innerHTML;
                    mainContent.innerHTML = bodyContent;
                    
                    // Re-apply event listeners for forms
                    setupFormListeners();
                } catch (error) {
                    mainContent.innerHTML = `<h2 class="text-3xl font-bold text-red-600">Error!</h2><p class="text-red-500">${error.message}</p>`;
                }
            }

            // Function to set up form submission handling
            function setupFormListeners() {
                const form = mainContent.querySelector('form');
                if (form) {
                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const formData = new FormData(form);
                        const data = Object.fromEntries(formData.entries());
                        
                        try {
                            const response = await fetch(form.action, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(data),
                            });

                            const text = await response.text();
                            // Update content based on login response
                            mainContent.innerHTML = text;

                        } catch (error) {
                            mainContent.innerHTML = `<h2 class="text-3xl font-bold text-red-600">Error!</h2><p class="text-red-500">${error.message}</p>`;
                        }
                    });
                }
            }

            // Listen for navigation clicks to handle SPA-like behavior
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const url = e.target.getAttribute('href');
                    history.pushState(null, '', url);
                    fetchAndDisplayContent(url);
                });
            });

            // Handle browser back/forward buttons
            window.addEventListener('popstate', () => {
                fetchAndDisplayContent(window.location.pathname + window.location.search);
            });

            // Initial content load on page load
            fetchAndDisplayContent(window.location.pathname + window.location.search);
        });
    </script>

</body>
</html>
